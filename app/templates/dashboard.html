{% extends "base.html" %}

{% block title %}AWS JobLens: Keyword Analysis{% endblock %}

{% block body_class %}dashboard-pg{% endblock %}

{% block content %}
<div class="container my-5">
    <!-- Page Title -->
    <div class="mb-4 text-center">
        <h1>AWS JobLens Dashboard</h1>
        <p>Explore insights from AWS-related job descriptions to identify popular skills and technologies.</p>
    </div>

    <!-- Keyword Analysis Chart -->
    <div class="col-md-12 mb-4">
        <div class="card shadow-sm p-4">
            <h3 class="section-title">Keyword Frequency Analysis</h3>
            <p class="section-description">This graph displays the most frequently mentioned keywords extracted from various AWS-related job descriptions. 
            Understanding these keywords helps identify in-demand skills and technologies, guiding users towards enhancing their profiles for better job recommendations.</p>
            <div id="keywordChart"></div>
        </div>
    </div>
    
    <!-- Job Title Distribution Graph -->
    <div class="col-md-12 mb-4">
        <div class="card shadow-sm p-4">
            <h3 class="section-title">Job Title Distribution</h3>
            <p class="section-description">This bar chart shows the distribution of various job titles from the dataset, helping to identify the most common job roles in AWS-related job descriptions.</p>
            <div id="jobTitleChart"></div>
        </div>
    </div>
</div>


<!-- Plotly.js for Graphs -->
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        console.log('✅ Dashboard Page Loaded');  // Debug Log

        // Fetch keyword data from Flask API
        fetch('/api/keywords')
            .then(response => response.json())
            .then(data => {
                console.log('✅ API Response Received:', data); // Debug Log

                var keywordChartData = [{
                    x: data.labels,
                    y: data.values,
                    type: 'bar',
                    marker: { color: 'teal' },
                    name: 'Keyword Frequency' // Adding legend name
                }];
                
                var layout = {
                    title: 'Top Keywords Extracted from AWS Job Descriptions',
                    xaxis: { title: 'Keywords' },
                    yaxis: { title: 'Frequency' },
                    margin: { t: 80 },
                    legend: { orientation: 'h', x: 0.5, xanchor: 'center', y: -0.2 } // Positioning the legend below the graph
                };

                Plotly.newPlot('keywordChart', keywordChartData, layout);
                console.log('✅ Graph Rendered Successfully'); // Debug Log
            })
            .catch(error => console.error('❌ Error fetching data:', error));
            // Fetch job title data from Flask API
        fetch('/api/job_titles')
            .then(response => response.json())
            .then(data => {
                if (data.labels.length === 0) {
                    console.error('❌ No data returned for job title distribution.');
                    return;
                }
                
                console.log('✅ Job Title API Response Received:', data); // Debug Log

                var jobTitleChartData = [{
                    x: data.labels,
                    y: data.values,
                    type: 'bar',
                    orientation: 'v',
                    marker: { color: 'skyblue' },
                    name: 'Job Title Frequency'
                }];
                
                var layout2 = {
                    title: 'AWS Job Title Distribution',
                    xaxis: { title: 'Job Titles', tickangle: 45, automargin: true },
                    yaxis: { title: 'Count' },
                    height: 800,
                    margin: { t: 80, b: 150 }
                };

                Plotly.newPlot('jobTitleChart', jobTitleChartData, layout2);
                console.log('✅ Job Title Graph Rendered Successfully');
            })
            .catch(error => console.error('❌ Error fetching job title data:', error));
    });
</script>
{% endblock %}
